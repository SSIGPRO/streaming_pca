This folder contains the MCU source files.

Three libraries are fundamental in order to use PCA streaming methods:
- CMSIS_DSP contains a reduced version of ARM CMSIS 5 digital signal processing library
- EXT_MATH_C contains an extension of CMSIS_DSP library especially made for this repository
- PCA_Streaming_C contains the implementation of the PCA streaming methods

Code has been designed on STM32CubeIDE. Core and Drivers folders have been generated by the IDE for STM32H743ZIT (rev. V) MCU, with
- 480 MHz CPU clock
- USART3 enabled in asynchronous mode, 4 Mbit/s baud rate, 8 bits word length, no parity bits, 1 stop bit, oversampling 8 samples

Core/Src/main.c file should be adapted given the test setup and the employed microcontroller. All the modification that should be performed are highlighted next.

First of all, check for the size of matrix Ut
``` C
/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
#define N 100
#define K 10
/* USER CODE END PD */
```
Keep in mind that in the case of minor subspace identification, k = n - m thus if n = 100, m = 10, k = 90.

Then check if all the necessary buffers have been instantiated
``` C
/* USER CODE BEGIN PV */
FLOAT_T main_buffer[N*(K+1)];
FLOAT_T * U_buff = main_buffer;         // n x k buffer
FLOAT_T * x_buff = main_buffer + N*K;   // n buffer
// Note: U and x MUST be adjacent for ISVD method

// Extra memory allocation
FLOAT_T dummy_buffer[N + 2*(K+1) + (K+1)*(K+1)];

// OJA & KRASULINA
FLOAT_T * kxk_buff = dummy_buffer;       // k x k buffer

// PAST, GROUSE & HFRANS
FLOAT_T * n_buff = dummy_buffer;          // n buffer
FLOAT_T * k_buff = dummy_buffer + N;      // k buffer
FLOAT_T * PT_buff = dummy_buffer + N + K; // k x k buffer

// ISVD
FLOAT_T * kp1_buffer = dummy_buffer;                      // k+1 buffer
FLOAT_T * kp1xkp1_buff = dummy_buffer + (K+1);            // k+1 x k+1 buffer
FLOAT_T * ps_buffer = dummy_buffer + (K+1) + (K+1)*(K+1); // k+1 buffer
```

Check for serial communication.
Serial communication is performed through two functions that must be defined:
``` C
void print_stream(char* msg, unsigned int length);
void scan_stream(char* msg, unsigned int length);
```
For example, the implementation already present in main.c use UART3 serial line:
``` C
void print_stream(char* msg, unsigned int length)
{
	HAL_UART_Transmit(&huart3, (uint8_t*)msg, length, 0xFFFFFFFF);
}
void scan_stream(char* msg, unsigned int length)
{
	HAL_UART_Receive(&huart3, (uint8_t*)msg, length, 0xFFFFFFFF);
}
```
And these functions must be fed to 
``` C
// Input-Output initialization
ext_set_print(print_stream);
ext_set_scan(scan_stream);
```
so that EXT_MATH_C library knows what function use to receive or send vectors and matrices through serial. Matrices are always sent row first.

Given all the previous steps and with the correct inclusion of all the necessary libraries, the code in the main loop should work.
